<div class="dashboard">
  <!-- Panel lateral -->
  <aside
    class="side-panel"
    [class.closed]="isSidePanelClosed"
    (mouseenter)="hoverPanel(true)"
    (mouseleave)="hoverPanel(false)"
  >
    <button class="toggle-btn" (click)="toggleSidePanel()">
      {{ isSidePanelClosed ? '‚ò∞' : '‚úï' }}
    </button>
    <h2 *ngIf="!isSidePanelClosed">Panel Admin</h2>

    <nav>
      <a routerLink="/admin" routerLinkActive="active">
        <i class="fas fa-home"></i>
        <span *ngIf="!isSidePanelClosed">Inicio</span>
      </a>
      <a routerLink="/admin/usuarios" routerLinkActive="active">
        <i class="fas fa-users"></i>
        <span *ngIf="!isSidePanelClosed">Usuarios</span>
      </a>
      <a routerLink="/admin/canchas" routerLinkActive="active">
        <i class="fas fa-futbol"></i>
        <span *ngIf="!isSidePanelClosed">Canchas</span>
      </a>
      <a routerLink="/admin/reservas" routerLinkActive="active">
        <i class="fas fa-calendar-check"></i>
        <span *ngIf="!isSidePanelClosed">Reservas</span>
      </a>

    </nav>

    <div class="user-info" *ngIf="!isSidePanelClosed">
      <p>{{ userEmail }}</p>
      <p>{{ userRole }}</p>
    </div>

    <button class="logout-btn" (click)="logout()">
      <i class="fas fa-sign-out-alt"></i>
      <span *ngIf="!isSidePanelClosed">Cerrar sesi√≥n</span>
    </button>
  </aside>

  <!-- Contenido principal -->
  <main [class.closed]="isSidePanelClosed">
    <section class="canchas-section">
      <h1>Canchas</h1>

      <!-- Buscador y bot√≥n de a√±adir cancha -->
      <div class="courts-toolbar">
        <div class="search-box">
        <input 
          type="text"
          placeholder="Buscar por codigo, nombre o tipo de deporte..."
          [(ngModel)]="searchTerm"
          (input)="filterCourts()"
          autocomplete="new-password"
          spellcheck="false"
        />
        </div>
        <button *ngIf="userRole === 'ADMIN'" class="add-btn" (click)="openForm(false)">
          A√±adir Cancha
        </button>
      </div>

      <!-- Modal formulario -->
      <div class="modal-backdrop" *ngIf="showForm && userRole === 'ADMIN'" (click)="cancelForm()">
        <div class="modal" (click)="$event.stopPropagation()">
          <h2>{{ editMode ? 'Editar Cancha' : 'Crear Nueva Cancha' }}</h2>

          <div class="form-group">
            <label>Nombre*:</label>
            <input type="text" [(ngModel)]="name" maxlength="50" placeholder="M√°x. 50 caracteres"/>
          </div>

          <div class="form-group">
            <label>Descripci√≥n:</label>
            <input type="text" [(ngModel)]="description" maxlength="200" placeholder="Opcional"/>
          </div>

          <div class="form-group">
            <label>Tipo de deporte</label>
            <input list="sportTypesList" [(ngModel)]="sportType" placeholder="Seleccione o escriba un deporte" />
            <datalist id="sportTypesList">
              <option *ngFor="let type of sportTypes" [value]="type"></option>
            </datalist>
          </div>

          <div class="form-group">
            <label>Precio por Hora*:</label>
            <input type="number" [(ngModel)]="pricePerHour" min="0" step="0.01" placeholder="Ej: 25"/>
          </div>

          <div class="form-actions">
            <button (click)="submitForm()">{{ editMode ? 'Guardar Cambios' : 'Crear Cancha' }}</button>
            <button type="button" (click)="cancelForm()">Cancelar</button>
          </div>
        </div>
      </div>

        <!-- Contenedor de selecci√≥n global y acciones masivas -->
        <div class="courts-toolbar">
          <!-- Checkbox global -->
          <div class="select-global">
            <label class="checkbox-label">
              <input
                type="checkbox"
                [checked]="selectAllGlobal"
                (change)="toggleSelectAllGlobal($event)"
              />
              <span>Seleccionar todos los registros</span>
            </label>
          </div>

          <!-- Acciones masivas -->
          <div
            class="bulk-actions"
            *ngIf="selectedCourts.length > 0"
          >
            <button
              class="delete-btn"
              (click)="deleteSelectedCourts()"
              [matTooltip]="selectedCourts.length === 0 ? 'No hay canchas seleccionadas para eliminar' : ''"
            >
              üóëÔ∏è Eliminar seleccionados
            </button>
          </div>
        </div>

        <!-- Tabla canchas -->
        <div class="table-container">
          <table class="usuarios-table">
            <thead>
              <tr>
                <th>
                  <input type="checkbox" [checked]="selectAllPage" (change)="toggleSelectAllPage($event)">
                </th>
                <th>C√≥digo</th>
                <th>Nombre</th>
                <th>Deporte</th>
                <th (click)="toggleSortByPrice()" style="cursor: pointer;">
                  Precio/Hora
                  <span *ngIf="sortDirection === 'asc'">‚ñ≤</span>
                  <span *ngIf="sortDirection === 'desc'">‚ñº</span>
                </th>
                <th *ngIf="userRole === 'ADMIN'">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let court of paginatedCourts">
                <td>
                  <input type="checkbox"
                        [checked]="selectedCourts.includes(court)"
                        (change)="toggleSelection(court, $event)"
                        [disabled]="court.hasReservations">
                </td>
                <td>{{ court.code }}</td>
                <td>{{ court.name }}</td>
                <td>{{ court.sportType }}</td>
                <td>{{ court.pricePerHour | currency }}</td>
                <td class="acciones" *ngIf="userRole === 'ADMIN'">
                  <button class="edit-btn" (click)="openForm(true, court)">‚úèÔ∏è Editar</button>
                  <button class="delete-btn" 
                          (click)="deleteCourt(court.id)"
                          [disabled]="court.hasReservations"
                          matTooltip="{{ court.hasReservations ? 'No se puede seleccionar, esta cancha tiene reservas' : '' }}"
                          >üóëÔ∏è Eliminar</button>
                </td>
              </tr>
            </tbody>
          </table>

          <p *ngIf="filteredCourts.length === 0" class="no-results">No se encontraron usuarios.</p>
            <p>{{ selectedCount }} cancha(s) seleccionada(s)</p>
          
          <!-- Paginaci√≥n -->
          <div class="pagination" *ngIf="totalPages > 1">
            <button (click)="previousPage()" [disabled]="currentPage === 1">‚¨Ö Anterior</button>
            <span>P√°gina {{ currentPage }} de {{ totalPages }}</span>
            <button (click)="nextPage()" [disabled]="currentPage === totalPages">Siguiente ‚û°</button>
          </div>
        </div>
    </section>
  </main>
</div>
